<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gra: Losowe Pytania i Odpowiedzi</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
.container { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
h1 { text-align:center; }
input, textarea, button { width:100%; padding:10px; margin:5px 0; }
.answer { background:#eee; padding:8px; margin:5px 0; border-radius:4px; }
</style>
</head>
<body>

<div class="container">
<h1>Gra: Losowe Pytania i Odpowiedzi</h1>

<div id="questionPhase">
<h3>Dodawaj pytania (wpisz "stop")</h3>
<input id="questionInput" />
<button id="addBtn">Dodaj pytanie</button>
<button id="startBtn">Start gry</button>
<ul id="questionList"></ul>
</div>

<div id="answerPhase" style="display:none;">
<h3>Odpowiedz na pytanie</h3>
<input id="nickInput" placeholder="Nick" />
<div id="randomQuestion"></div>
<textarea id="answerInput" placeholder="Odpowied≈∫"></textarea>
<button id="nextBtn">Wy≈õlij odpowied≈∫</button>
</div>

<div id="resultPhase" style="display:none;">
<h3>Wyniki</h3>
<div id="results"></div>
</div>
</div>

<script>
const socket = new WebSocket(`wss://${window.location.host}`);

const questions = [];
let currentQuestion = null;
const answers = [];
let gameStarted = false;

socket.onopen = () => console.log("üü¢ Po≈ÇƒÖczono z WebSocket");
socket.onerror = (err) => console.error("‚ùå B≈ÇƒÖd WebSocket:", err);

socket.onmessage = (event) => {
const data = JSON.parse(event.data);

switch(data.type) {
  case 'addQuestion':
    questions.push(data.text);
    addQuestionToList(data.text);
    break;

  case 'PHASE_QUESTIONS_END':
    gameStarted = true;
    document.getElementById('questionPhase').style.display = 'none';
    document.getElementById('answerPhase').style.display = 'block';
    break;

  case 'NEW_QUESTION':
    currentQuestion = data.question;
    document.getElementById('randomQuestion').innerHTML = `<strong>${currentQuestion}</strong>`;
    break;

  case 'answer':
    answers.push(data.payload);
    showResults();
    break;

  case 'SHOW_RESULTS':
    document.getElementById('answerPhase').style.display = 'none';
    document.getElementById('resultPhase').style.display = 'block';
    break;

  case 'SYNC_GAME':
    data.questions.forEach(q => { if (!questions.includes(q)) { questions.push(q); addQuestionToList(q); } });
    data.answers.forEach(a => { answers.push(a); });
    currentQuestion = data.questions[data.currentQuestionIndex] || null;
    if (data.gameStarted) {
      document.getElementById('questionPhase').style.display = 'none';
      document.getElementById('answerPhase').style.display = 'block';
      if (currentQuestion) document.getElementById('randomQuestion').innerHTML = `<strong>${currentQuestion}</strong>`;
    }
    showResults();
    break;
}
};

document.getElementById('addBtn').onclick = () => {
const input = document.getElementById('questionInput');
const text = input.value.trim();
if (!text) return;
if (socket.readyState === WebSocket.OPEN) {
  socket.send(JSON.stringify({ type: 'addQuestion', text }));
} else {
  alert("Po≈ÇƒÖczenie z serwerem jeszcze siƒô nie nawiƒÖza≈Ço");
}
input.value = '';
};

document.getElementById('startBtn').onclick = () => {
if (questions.length === 0) { alert('Dodaj przynajmniej jedno pytanie'); return; }
if (socket.readyState === WebSocket.OPEN) {
  socket.send(JSON.stringify({ type: 'startGame' }));
} else {
  alert("Po≈ÇƒÖczenie z serwerem jeszcze siƒô nie nawiƒÖza≈Ço");
}
};

document.getElementById('nextBtn').onclick = () => {
const nick = document.getElementById('nickInput').value.trim();
const answer = document.getElementById('answerInput').value.trim();
if (!nick || !answer) { alert("Podaj nick i odpowied≈∫"); return; }

if (socket.readyState === WebSocket.OPEN) {
  socket.send(JSON.stringify({ type: 'answer', payload: { question: currentQuestion, answer, nick } }));
  socket.send(JSON.stringify({ type: 'nextQuestion' }));
} else {
  alert("Po≈ÇƒÖczenie z serwerem jeszcze siƒô nie nawiƒÖza≈Ço");
}

document.getElementById('answerInput').value = '';
};

function addQuestionToList(text) {
const li = document.createElement("li");
li.textContent = text;
document.getElementById("questionList").appendChild(li);
}

function showResults() {
const div = document.getElementById("results");
div.innerHTML = '';
answers.forEach(a => {
  const el = document.createElement("div");
  el.className = "answer";
  el.innerHTML = `<strong>${a.question}</strong><br>${a.answer} <em>(${a.nick})</em>`;
  div.appendChild(el);
});
}
</script>

</body>
</html>
